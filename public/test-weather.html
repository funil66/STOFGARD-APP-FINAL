<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Widget Clima</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        #test-widget { background: white; padding: 20px; border-radius: 8px; max-width: 400px; margin: 20px auto; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .log { background: #000; color: #0f0; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; margin-top: 20px; white-space: pre-wrap; max-height: 400px; overflow-y: auto; }
        .result { margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üå§Ô∏è Teste do Widget de Clima</h1>
    
    <div id="test-widget">
        <h2>Teste com Ribeir√£o Preto</h2>
        <button onclick="testWeather('Ribeirao Preto')">Testar "Ribeirao Preto"</button>
        <button onclick="testWeather('Ribeir√£o Preto')">Testar "Ribeir√£o Preto" (com acento)</button>
        <button onclick="testWeather('ribeirao preto')">Testar min√∫sculo</button>
        
        <div id="result" class="result" style="display:none;">
            <h3>Resultado:</h3>
            <div id="result-content"></div>
        </div>
    </div>
    
    <div class="log" id="console"></div>

    <script>
        const logDiv = document.getElementById('console');
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            logDiv.textContent += args.join(' ') + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            logDiv.textContent += '‚ùå ERROR: ' + args.join(' ') + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
        };
        
        console.log('=== TESTE DO WIDGET DE CLIMA ===');
        console.log('Host:', window.location.host);
        console.log('');
        
        async function testWeather(city) {
            const resultDiv = document.getElementById('result');
            const resultContent = document.getElementById('result-content');
            
            console.log(`\nüîç Testando cidade: "${city}"`);
            console.log(`üì° URL: /api/widget/weather?city=${encodeURIComponent(city)}`);
            
            try {
                const response = await fetch(`/api/widget/weather?city=${encodeURIComponent(city)}`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                
                console.log(`üì• Status: ${response.status} ${response.statusText}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('‚úÖ Dados recebidos:', JSON.stringify(result, null, 2));
                
                if (result.success && result.data) {
                    resultContent.innerHTML = `
                        <strong>üåç Cidade:</strong> ${result.data.city} (${result.data.country})<br>
                        <strong>üå°Ô∏è Temperatura:</strong> ${result.data.temperature}¬∞C<br>
                        <strong>üí® Sensa√ß√£o:</strong> ${result.data.feels_like}¬∞C<br>
                        <strong>‚òÅÔ∏è Descri√ß√£o:</strong> ${result.data.description}<br>
                        <strong>üíß Umidade:</strong> ${result.data.humidity}%<br>
                        <img src="${result.data.icon_url}" alt="${result.data.description}">
                    `;
                    resultDiv.style.display = 'block';
                    console.log('‚úÖ SUCESSO!');
                } else {
                    throw new Error(result.message || 'Dados inv√°lidos');
                }
                
            } catch (err) {
                console.error('Erro:', err.message);
                resultContent.innerHTML = `<strong>‚ùå Erro:</strong> ${err.message}`;
                resultDiv.style.display = 'block';
            }
        }
    </script>
</body>
</html>
