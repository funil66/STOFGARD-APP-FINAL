<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Widget Clima - Visual</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: #f3f4f6;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
        }
        
        .banner-azul {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            overflow: visible !important;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="text-3xl font-bold mb-8 text-gray-800">üß™ Teste Visual do Widget de Clima</h1>
        
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">Informa√ß√µes do Teste</h2>
            <ul class="space-y-2 text-sm text-gray-700">
                <li><strong>Objetivo:</strong> Verificar se o widget renderiza corretamente dentro da faixa azul</li>
                <li><strong>API Endpoint:</strong> <code class="bg-gray-100 px-2 py-1 rounded">/api/widget/weather</code></li>
                <li><strong>Cidade:</strong> <code class="bg-gray-100 px-2 py-1 rounded">Ribeir√£o Preto</code></li>
            </ul>
        </div>

        <!-- Simula√ß√£o da Faixa Azul do Dashboard -->
        <div class="banner-azul w-full rounded-xl shadow-2xl relative text-white px-8 py-8 mb-8">
            <div class="relative z-10">
                <h2 class="text-2xl font-bold mb-4">STOFGARD Dashboard</h2>
                
                <!-- Container do Widget (alinhado √† direita) -->
                <div class="flex justify-end">
                    <div id="weather-widget" 
                         data-city="Ribeir√£o Preto"
                         class="rounded-xl shadow-lg border border-white/20 relative transition-transform duration-300 hover:scale-105"
                         style="width: 100%; max-width: 280px; min-height: 80px; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); z-index: 50; overflow: visible;">

                        <!-- Skeleton Loading -->
                        <div id="weather-loading" class="flex flex-col items-center justify-center h-20 text-white/80 gap-2">
                            <div class="flex gap-1">
                                <div class="w-2 h-2 bg-white/60 rounded-full animate-bounce" style="animation-delay: 0s;"></div>
                                <div class="w-2 h-2 bg-white/60 rounded-full animate-bounce" style="animation-delay: 0.2s;"></div>
                                <div class="w-2 h-2 bg-white/60 rounded-full animate-bounce" style="animation-delay: 0.4s;"></div>
                            </div>
                            <span class="text-xs font-medium tracking-wider">Carregando clima...</span>
                        </div>

                        <!-- Container de Dados -->
                        <div id="weather-content" class="hidden h-20 p-3 flex items-center justify-between gap-3">
                            <div class="flex items-center gap-2">
                                <img id="weather-icon" src="" alt="" class="w-12 h-12" />
                                <div>
                                    <div class="text-2xl font-bold text-white">
                                        <span id="weather-temp">--</span>¬∞C
                                    </div>
                                    <div class="text-xs text-blue-100" id="weather-desc">--</div>
                                </div>
                            </div>
                            <div class="text-right text-xs text-blue-100">
                                <div id="weather-city" class="font-semibold">--</div>
                                <div>Sensa√ß√£o: <span id="weather-feels">--</span>¬∞C</div>
                            </div>
                        </div>

                        <!-- Mensagem de Erro -->
                        <div id="weather-error" class="hidden flex flex-col items-center justify-center h-20 text-white/80 gap-1">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-yellow-300">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                            </svg>
                            <span class="text-xs font-medium text-center px-2">N√£o foi poss√≠vel carregar o clima</span>
                        </div>

                        <!-- Bot√£o Config -->
                        <a href="/admin/configuracoes"
                            class="absolute top-2 right-2 p-1.5 rounded-full bg-white/20 hover:bg-white text-white hover:text-blue-600 transition-all shadow-lg z-[60]"
                            title="Configurar Widget">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Console de Debug -->
        <div class="bg-gray-900 text-green-400 rounded-lg p-4 font-mono text-sm">
            <div class="flex items-center justify-between mb-2">
                <h3 class="font-bold text-white">üìã Console de Debug</h3>
                <button onclick="clearLogs()" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs">
                    Limpar
                </button>
            </div>
            <div id="debug-console" class="space-y-1 max-h-96 overflow-y-auto">
                <div class="text-gray-500">Aguardando logs...</div>
            </div>
        </div>
    </div>

    <script>
        // Console Override para capturar logs
        const debugConsole = document.getElementById('debug-console');
        const originalLog = console.log;
        const originalError = console.error;

        function addLog(message, type = 'log') {
            const div = document.createElement('div');
            div.className = type === 'error' ? 'text-red-400' : 'text-green-400';
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            debugConsole.appendChild(div);
            debugConsole.scrollTop = debugConsole.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '), 'log');
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addLog(args.join(' '), 'error');
        };

        function clearLogs() {
            debugConsole.innerHTML = '<div class="text-gray-500">Console limpo...</div>';
        }

        // Widget Weather Code
        (function() {
            console.log('üöÄ Script do clima iniciado');
            console.log('üìã Estado do DOM: ' + document.readyState);
            
            const initWeather = () => {
                console.log('üé¨ initWeather() executado');
                
                const widget = document.getElementById('weather-widget');
                
                if (!widget) {
                    console.error('‚ùå Widget n√£o encontrado!');
                    return;
                }
                
                console.log('‚úÖ Widget encontrado');
                console.log('üìê Display: ' + window.getComputedStyle(widget).display);
                console.log('üìè Vis√≠vel: ' + (widget.offsetWidth > 0 && widget.offsetHeight > 0));
                
                const loading = document.getElementById('weather-loading');
                const content = document.getElementById('weather-content');
                const error = document.getElementById('weather-error');
                
                const city = widget.getAttribute('data-city') || 'S√£o Paulo';
                console.log('üå§Ô∏è Carregando clima para: ' + city);
                
                async function loadWeather() {
                    try {
                        const url = `/api/widget/weather?city=${encodeURIComponent(city)}`;
                        console.log('üì° URL: ' + url);
                        
                        const response = await fetch(url, {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json',
                                'X-Requested-With': 'XMLHttpRequest'
                            }
                        });
                        
                        console.log('üì• Status: ' + response.status);
                        
                        if (!response.ok) {
                            throw new Error('HTTP ' + response.status);
                        }
                        
                        const result = await response.json();
                        console.log('‚úÖ Dados: ' + JSON.stringify(result));
                        
                        if (result.success && result.data) {
                            document.getElementById('weather-icon').src = result.data.icon_url;
                            document.getElementById('weather-temp').textContent = result.data.temperature;
                            document.getElementById('weather-desc').textContent = result.data.description;
                            document.getElementById('weather-city').textContent = result.data.city;
                            document.getElementById('weather-feels').textContent = result.data.feels_like;
                            
                            loading.classList.add('hidden');
                            content.classList.remove('hidden');
                            console.log('‚úÖ Widget carregado!');
                        } else {
                            throw new Error('Dados inv√°lidos');
                        }
                        
                    } catch (err) {
                        console.error('‚ùå Erro: ' + err.message);
                        loading.classList.add('hidden');
                        error.classList.remove('hidden');
                    }
                }
                
                loadWeather();
            };
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initWeather);
            } else {
                setTimeout(initWeather, 100);
            }
        })();
    </script>
</body>
</html>
